<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay</title>
    <!-- El CSS será inyectado por Java -->
    <link href="./css/floating_styles.css" rel="stylesheet">
</head>

<body>
    <button id="close-button" class="close-btn">&times;</button>

    <header class="header-nav">
        <!-- Pestaña de Perfil / Juego -->
        <div class="nav-tab active" id="profile-tab" data-tab="profile">
            <!-- ¡LOS ELEMENTOS VUELVEN A TENER SUS IDs CORRECTOS! -->
            <img id="user-avatar" src="">
            <span id="user-username"></span>
        </div>
        <!-- Pestaña de Chats -->
        <div class="nav-tab" id="chat-tab" data-tab="chats">
            <svg width="17" height="15" viewBox="0 0 17 15" fill="currentColor">
                <path
                    d="M15.5833 0.0625H1.41663C1.13483 0.0625 0.864582 0.174442 0.665325 0.373699C0.466068 0.572957 0.354126 0.843208 0.354126 1.125V10.7229C0.355017 10.8605 0.383371 10.9966 0.437525 11.1231C0.49168 11.2497 0.570547 11.3641 0.669502 11.4598C0.768458 11.5554 0.885512 11.6304 1.0138 11.6802C1.1421 11.73 1.27905 11.7538 1.41663 11.75H3.54163V14.5833C3.5405 14.6481 3.5579 14.7119 3.59178 14.7671C3.62567 14.8223 3.67462 14.8667 3.73288 14.895C3.7867 14.9298 3.84942 14.9483 3.9135 14.9483C3.97758 14.9483 4.0403 14.9298 4.09413 14.895L8.61329 11.75H15.5833C15.8651 11.75 16.1353 11.6381 16.3346 11.4388C16.5338 11.2395 16.6458 10.9693 16.6458 10.6875V1.125C16.6458 0.843208 16.5338 0.572957 16.3346 0.373699C16.1353 0.174442 15.8651 0.0625 15.5833 0.0625ZM13.4583 6.08333C13.4583 6.29348 13.396 6.4989 13.2792 6.67363C13.1625 6.84835 12.9965 6.98454 12.8024 7.06496C12.6082 7.14537 12.3946 7.16642 12.1885 7.12542C11.9824 7.08442 11.7931 6.98323 11.6445 6.83463C11.4959 6.68604 11.3947 6.49672 11.3537 6.29062C11.3127 6.08451 11.3338 5.87088 11.4142 5.67673C11.4946 5.48259 11.6308 5.31665 11.8055 5.1999C11.9802 5.08315 12.1856 5.02083 12.3958 5.02083C12.6776 5.02083 12.9478 5.13278 13.1471 5.33203C13.3463 5.53129 13.4583 5.80154 13.4583 6.08333ZM3.54163 6.08333C3.54163 5.87319 3.60394 5.66777 3.72069 5.49304C3.83744 5.31831 4.00338 5.18213 4.19752 5.10171C4.39167 5.02129 4.6053 5.00025 4.81141 5.04125C5.01751 5.08225 5.20683 5.18344 5.35543 5.33203C5.50402 5.48063 5.60521 5.66995 5.64621 5.87605C5.68721 6.08215 5.66617 6.29579 5.58575 6.48993C5.50533 6.68408 5.36915 6.85002 5.19442 6.96677C5.01969 7.08352 4.81427 7.14583 4.60413 7.14583C4.32233 7.14583 4.05208 7.03389 3.85282 6.83463C3.65357 6.63538 3.54163 6.36513 3.54163 6.08333ZM7.43746 6.08333C7.43746 5.87319 7.49977 5.66777 7.61652 5.49304C7.73327 5.31831 7.89921 5.18213 8.09336 5.10171C8.2875 5.02129 8.50114 5.00025 8.70724 5.04125C8.91335 5.08225 9.10267 5.18344 9.25126 5.33203C9.39985 5.48063 9.50105 5.66995 9.54204 5.87605C9.58304 6.08215 9.562 6.29579 9.48158 6.48993C9.40116 6.68408 9.26498 6.85002 9.09025 6.96677C8.91552 7.08352 8.7101 7.14583 8.49996 7.14583C8.21817 7.14583 7.94792 7.03389 7.74866 6.83463C7.5494 6.63538 7.43746 6.36513 7.43746 6.08333Z"
                    fill="currentColor" />
            </svg>
        </div>
        <div class="nav-tab" id="party-tab"><svg width="20" height="14" viewBox="0 0 20 14" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M7 0C3.134 0 0 3.134 0 7C0 10.866 3.134 14 7 14H13C16.866 14 20 10.866 20 7C20 3.134 16.866 0 13 0H7ZM6.125 4C6.47 4 6.75 4.28 6.75 4.625V6.5H8.375C8.54076 6.5 8.69973 6.56585 8.81694 6.68306C8.93415 6.80027 9 6.95924 9 7.125C9 7.29076 8.93415 7.44973 8.81694 7.56694C8.69973 7.68415 8.54076 7.75 8.375 7.75H6.75V9.375C6.75 9.54076 6.68415 9.69973 6.56694 9.81694C6.44973 9.93415 6.29076 10 6.125 10C5.95924 10 5.80027 9.93415 5.68306 9.81694C5.56585 9.69973 5.5 9.54076 5.5 9.375V7.75H3.625C3.45924 7.75 3.30027 7.68415 3.18306 7.56694C3.06585 7.44973 3 7.29076 3 7.125C3 6.95924 3.06585 6.80027 3.18306 6.68306C3.30027 6.56585 3.45924 6.5 3.625 6.5H5.5V4.625C5.5 4.28 5.78 4 6.125 4ZM14 8.75C14 9.08152 13.8683 9.39946 13.6339 9.63388C13.3995 9.8683 13.0815 10 12.75 10C12.4185 10 12.1005 9.8683 11.8661 9.63388C11.6317 9.39946 11.5 9.08152 11.5 8.75C11.5 8.41848 11.6317 8.10054 11.8661 7.86612C12.1005 7.6317 12.4185 7.5 12.75 7.5C13.0815 7.5 13.3995 7.6317 13.6339 7.86612C13.8683 8.10054 14 8.41848 14 8.75ZM14.75 6.5C14.4185 6.5 14.1005 6.3683 13.8661 6.13388C13.6317 5.89946 13.5 5.58152 13.5 5.25C13.5 4.91848 13.6317 4.60054 13.8661 4.36612C14.1005 4.1317 14.4185 4 14.75 4C15.0815 4 15.3995 4.1317 15.6339 4.36612C15.8683 4.60054 16 4.91848 16 5.25C16 5.58152 15.8683 5.89946 15.6339 6.13388C15.3995 6.3683 15.0815 6.5 14.75 6.5Z"
                    fill="currentColor" />
            </svg></div>
        <div class="nav-tab" id="stream-tab"><svg width="20" height="16" viewBox="0 0 20 16" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M4.34303 0.938015C4.43601 1.03089 4.50976 1.14118 4.56009 1.26257C4.61041 1.38397 4.63632 1.5141 4.63632 1.64551C4.63632 1.77693 4.61041 1.90706 4.56009 2.02846C4.50976 2.14985 4.43601 2.26014 4.34303 2.35301C2.84247 3.85383 1.99948 5.88922 1.99948 8.01152C1.99948 10.1338 2.84247 12.1692 4.34303 13.67C4.43854 13.7623 4.51472 13.8726 4.56713 13.9946C4.61954 14.1166 4.64713 14.2478 4.64828 14.3806C4.64943 14.5134 4.62413 14.6451 4.57385 14.768C4.52357 14.8909 4.44932 15.0025 4.35542 15.0964C4.26153 15.1903 4.14988 15.2646 4.02698 15.3148C3.90409 15.3651 3.77241 15.3904 3.63963 15.3893C3.50685 15.3881 3.37563 15.3605 3.25362 15.3081C3.13162 15.2557 3.02128 15.1795 2.92903 15.084C-0.977971 11.178 -0.977971 4.84402 2.92903 0.938015C3.11656 0.750544 3.37087 0.645228 3.63603 0.645228C3.90119 0.645228 4.1555 0.750544 4.34303 0.938015ZM17.075 0.938015C20.981 4.84502 20.981 11.178 17.075 15.084C16.8875 15.2717 16.6332 15.3771 16.3679 15.3772C16.1026 15.3773 15.8482 15.272 15.6605 15.0845C15.4729 14.897 15.3674 14.6426 15.3673 14.3774C15.3672 14.1121 15.4725 13.8577 15.66 13.67C17.1606 12.1692 18.0036 10.1338 18.0036 8.01152C18.0036 5.88922 17.1606 3.85383 15.66 2.35301C15.4724 2.16537 15.367 1.91088 15.367 1.64551C15.367 1.38015 15.4724 1.12566 15.66 0.938015C15.8477 0.750374 16.1022 0.644959 16.3675 0.644958C16.6329 0.644958 16.8874 0.750374 17.075 0.938015ZM7.31003 3.81201C7.4975 3.99954 7.60282 4.25385 7.60282 4.51901C7.60282 4.78418 7.4975 5.03849 7.31003 5.22601C6.94598 5.59003 6.6572 6.02218 6.46018 6.4978C6.26315 6.97343 6.16175 7.4832 6.16175 7.99801C6.16175 8.51283 6.26315 9.0226 6.46018 9.49823C6.6572 9.97385 6.94598 10.406 7.31003 10.77C7.40287 10.8629 7.47651 10.9732 7.52673 11.0946C7.57695 11.2159 7.60278 11.346 7.60273 11.4774C7.60269 11.6087 7.57677 11.7388 7.52646 11.8601C7.47615 11.9814 7.40244 12.0917 7.30953 12.1845C7.21662 12.2774 7.10633 12.351 6.98496 12.4012C6.8636 12.4514 6.73352 12.4773 6.60218 12.4772C6.47083 12.4772 6.34077 12.4513 6.21944 12.4009C6.09811 12.3506 5.98787 12.2769 5.89503 12.184C4.78486 11.0738 4.16117 9.56806 4.16117 7.99801C4.16117 6.42797 4.78486 4.92222 5.89503 3.81201C5.9879 3.71904 6.09819 3.64528 6.21959 3.59495C6.34099 3.54463 6.47111 3.51873 6.60253 3.51873C6.73394 3.51873 6.86407 3.54463 6.98547 3.59495C7.10687 3.64528 7.21716 3.71904 7.31003 3.81201ZM14.268 3.81201C15.3782 4.92222 16.0019 6.42797 16.0019 7.99801C16.0019 9.56806 15.3782 11.0738 14.268 12.184C14.0794 12.3662 13.8268 12.467 13.5646 12.4647C13.3024 12.4624 13.0516 12.3572 12.8662 12.1718C12.6808 11.9864 12.5756 11.7356 12.5734 11.4734C12.5711 11.2112 12.6719 10.9586 12.854 10.77C13.2181 10.406 13.5069 9.97385 13.7039 9.49823C13.9009 9.0226 14.0023 8.51283 14.0023 7.99801C14.0023 7.4832 13.9009 6.97343 13.7039 6.4978C13.5069 6.02218 13.2181 5.59003 12.854 5.22601C12.6719 5.03741 12.5711 4.78481 12.5734 4.52261C12.5756 4.26042 12.6808 4.0096 12.8662 3.8242C13.0516 3.63879 13.3024 3.53362 13.5646 3.53134C13.8268 3.52906 14.0794 3.62986 14.268 3.81201ZM10.082 6.58201C10.4799 6.58201 10.8614 6.74005 11.1427 7.02135C11.424 7.30266 11.582 7.68419 11.582 8.08201C11.582 8.47984 11.424 8.86137 11.1427 9.14268C10.8614 9.42398 10.4799 9.58201 10.082 9.58201C9.68421 9.58201 9.30267 9.42398 9.02137 9.14268C8.74006 8.86137 8.58203 8.47984 8.58203 8.08201C8.58203 7.68419 8.74006 7.30266 9.02137 7.02135C9.30267 6.74005 9.68421 6.58201 10.082 6.58201Z"
                    fill="currentColor" />
            </svg></div>
    </header>

    <main>
        <!-- CONTENIDO DE LA PESTAÑA PERFIL/JUEGO (Visible por defecto) -->
        <div class="page-content active" id="profile-content">
            <section id="game-info" class="content-section">
                <div class="section-title">Jugando ahora:</div>
                <div class="game-display">
                    <img id="game-icon" class="game-icon" src="">
                    <div id="game-name" class="game-name">Detectando...</div>
                </div>

                <!-- ========================================================== -->
                <!-- === SECCIÓN DE REGISTRO REESTRUCTURADA === -->
                <!-- ========================================================== -->
                <div id="registration-section" style="display: none;">

                    <!-- Estado 1: Vista Inicial (Botón para iniciar el registro) -->
                    <div id="register-initial-view">
                        <p class="registration-prompt">Este juego no está registrado</p>
                        <button id="register-btn" class="register-btn">Registrar</button>
                    </div>

                    <!-- Estado 2: Vista de Formulario (Oculto por defecto) -->
                    <div id="register-form-view" style="display: none;">
                        <input type="text" id="register-app-name-input" placeholder="Dale un nombre (ej. Minecraft)"
                            class="register-input">
                        <button id="save-app-btn" class="register-btn">Guardar</button>
                    </div>

                </div>
                <!-- ========================================================== -->

                <div id="classification-section" style="display: none;">
                    <p class="classification-prompt">Es un juego?</p>
                    <div class="classification-actions">
                        <button id="classify-no-btn" class="classify-btn classify-no">&times;</button>
                        <button id="classify-yes-btn" class="classify-btn classify-yes">&#10003;</button>
                    </div>
                </div>
            </section>
            <section id="friends-list" class="content-section">
                <div class="section-title"><svg width="22" height="18" viewBox="0 0 22 18">
                        <path
                            d="M2 4C2 3.54037 2.09053 3.08525 2.26642 2.66061C2.44231 2.23597 2.70012 1.85013 3.02513 1.52513C3.35013 1.20012 3.73597 0.942313 4.16061 0.766422C4.58525 0.59053 5.04037 0.5 5.5 0.5C5.95963 0.5 6.41475 0.59053 6.83939 0.766422C7.26403 0.942313 7.64987 1.20012 7.97487 1.52513C8.29988 1.85013 8.55769 2.23597 8.73358 2.66061C8.90947 3.08525 9 3.54037 9 4C9 4.45963 8.90947 4.91475 8.73358 5.33939C8.55769 5.76403 8.29988 6.14987 7.97487 6.47487C7.64987 6.79988 7.26403 7.05769 6.83939 7.23358C6.41475 7.40947 5.95963 7.5 5.5 7.5C5.04037 7.5 4.58525 7.40947 4.16061 7.23358C3.73597 7.05769 3.35013 6.79988 3.02513 6.47487C2.70012 6.14987 2.44231 5.76403 2.26642 5.33939C2.09053 4.91475 2 4.45963 2 4ZM0 14.5C0 11.4625 2.4625 9 5.5 9C8.5375 9 11 11.4625 11 14.5V14.6875C11 15.4125 10.4125 16 9.6875 16H1.3125C0.5875 16 0 15.4125 0 14.6875V14.5ZM13.5 2C14.2956 2 15.0587 2.31607 15.6213 2.87868C16.1839 3.44129 16.5 4.20435 16.5 5C16.5 5.79565 16.1839 6.55871 15.6213 7.12132C15.0587 7.68393 14.2956 8 13.5 8C12.7044 8 11.9413 7.68393 11.3787 7.12132C10.8161 6.55871 10.5 5.79565 10.5 5C10.5 4.20435 10.8161 3.44129 11.3787 2.87868C11.9413 2.31607 12.7044 2 13.5 2ZM13.5 9.5C15.9844 9.5 18 11.5156 18 14V14.7C18 15.4187 17.4188 16 16.7 16H12.175C12.3813 15.6094 12.5 15.1625 12.5 14.6875V14.5C12.5 12.8906 11.9563 11.4094 11.0469 10.2281C11.7531 9.76875 12.5969 9.5 13.5 9.5Z"
                            fill="white" />
                    </svg> Amigos</div>
                <div id="friends-container">
                    <!-- El JS llenará esta lista -->
                </div>
            </section>
        </div>

        <!-- CONTENIDO DE LA PESTAÑA DE CHATS (Oculto por defecto) -->
        <div class="page-content" id="chats-content" style="display: none;">
            <div class="section-title">Chats Recientes</div>
            <div id="chat-list-container">
                <!-- El JS llenará la lista de conversaciones aquí -->
            </div>
        </div>
    </main>

    <!-- ============================================= -->
    <!-- === NUEVA VISTA PARA LA PANTALLA DE CHAT === -->
    <!-- ============================================= -->
    <div id="chat-view" class="chat-view-container" style="display: none;">
        <header class="chat-header">
            <button id="back-to-main-view-btn" class="chat-back-btn">←</button>
            <div class="chat-header-info">
                <img id="chat-partner-avatar" src="">
                <span id="chat-partner-username"></span>
            </div>
        </header>

        <div id="sticky-date-header" class="sticky-date-header">
            <span></span>
        </div>

        <main id="chat-messages-container" class="chat-messages"></main>

        <div id="reply-context-bar" class="reply-context">
            <div class="reply-preview">
                Respondiendo a <strong id="reply-to-user"></strong>
                <span id="reply-snippet"></span>
            </div>
            <button id="cancel-reply-btn" class="cancel-reply-btn">&times;</button>
        </div>


        <!-- BOTÓN SCROLL ABAJO -->
        <button id="scroll-bottom-btn" class="scroll-bottom-btn" style="display: none;">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z" />
            </svg>
            <div id="scroll-unread-badge" class="scroll-unread-badge" style="display: none;">0</div>
        </button>

        <form id="chat-form" class="chat-input-bar">
            <textarea id="chat-message-input" placeholder="Escribe un mensaje..." rows="1"></textarea>
            <button type="submit" id="send-chat-btn" class="chat-send-btn"><svg xmlns="http://www.w3.org/2000/svg"
                    width="24" height="24" viewBox="0 0 24 24">
                    <path fill="currentColor" fill-rule="evenodd"
                        d="M3.402 6.673c-.26-2.334 2.143-4.048 4.266-3.042l11.944 5.658c2.288 1.083 2.288 4.339 0 5.422L7.668 20.37c-2.123 1.006-4.525-.708-4.266-3.042L3.882 13H12a1 1 0 1 0 0-2H3.883z"
                        clip-rule="evenodd" />
                </svg></button>
        </form>
    </div>

    <div id="context-menu-overlay" class="context-overlay"></div>

    <div id="context-menu" class="context-menu">
        <div id="context-menu-options" class="context-menu-options">
            <button id="reply-from-menu-btn" class="context-menu-button">
                <span class="context-menu-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"
                        fill="currentColor">
                        <path
                            d="M6.40625 1.08752C6.76562 1.24689 7 1.60627 7 2.00002V4.00002H10.5C13.5375 4.00002 16 6.46252 16 9.50002C16 13.0406 13.4531 14.6219 12.8687 14.9406C12.7906 14.9844 12.7031 15 12.6156 15C12.275 15 12 14.7219 12 14.3844C12 14.15 12.1344 13.9344 12.3062 13.775C12.6 13.5 13 12.95 13 12.0031C13 10.3469 11.6562 9.00314 10 9.00314H7V11.0031C7 11.3969 6.76875 11.7563 6.40625 11.9156C6.04375 12.075 5.625 12.0094 5.33125 11.7469L0.33125 7.24689C0.121875 7.05314 0 6.78439 0 6.50002C0 6.21564 0.121875 5.94689 0.33125 5.75627L5.33125 1.25627C5.625 0.990644 6.04688 0.925019 6.40625 1.08752Z" />
                    </svg>
                </span>
                <span class="context-menu-text">Responder</span>
            </button>
            <button id="copy-btn" class="context-menu-button">
                <span class="context-menu-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18"
                        fill="currentColor">
                        <path
                            d="M14.3438 16.875H6.46875C5.79742 16.875 5.15359 16.6083 4.67889 16.1336C4.20418 15.6589 3.9375 15.0151 3.9375 14.3438V6.46875C3.9375 5.79742 4.20418 5.15359 4.67889 4.67889C5.15359 4.20418 5.79742 3.9375 6.46875 3.9375H14.3438C15.0151 3.9375 15.6589 4.20418 16.1336 4.67889C16.6083 5.15359 16.875 5.79742 16.875 6.46875V14.3438C16.875 15.0151 16.6083 15.6589 16.1336 16.1336C15.6589 16.6083 15.0151 16.875 14.3438 16.875Z" />
                        <path
                            d="M5.625 2.8125H13.9177C13.7426 2.31934 13.4193 1.89242 12.9921 1.59029C12.5648 1.28816 12.0545 1.12563 11.5312 1.125H3.65625C2.98492 1.125 2.34109 1.39168 1.86639 1.86639C1.39168 2.34109 1.125 2.98492 1.125 3.65625V11.5312C1.12563 12.0545 1.28816 12.5648 1.59029 12.9921C1.89242 13.4193 2.31934 13.7426 2.8125 13.9177V5.625C2.8125 4.87908 3.10882 4.16371 3.63626 3.63626C4.16371 3.10882 4.87908 2.8125 5.625 2.8125Z" />
                    </svg>
                </span>
                <span class="context-menu-text">Copiar</span>
            </button>
            <button id="delete-from-menu-btn" class="context-menu-button destructive" style="display: none;">
                <span class="context-menu-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="18" viewBox="0 0 14 18" fill="#D33F49">
                        <path
                            d="M1 16C1 17.1 1.9 18 3 18H11C12.1 18 13 17.1 13 16V6C13 4.9 12.1 4 11 4H3C1.9 4 1 4.9 1 6V16ZM13 1H10.5L9.79 0.29C9.61 0.11 9.35 0 9.09 0H4.91C4.65 0 4.39 0.11 4.21 0.29L3.5 1H1C0.45 1 0 1.45 0 2C0 2.55 0.45 3 1 3H13C13.55 3 14 2.55 14 2C14 1.45 13.55 1 13 1Z"
                            fill="#D33F49" />
                    </svg>
                </span>
                <span class="context-menu-text">Eliminar</span>
            </button>
        </div>
    </div>

    <div id="delete-confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h4>Confirmar Eliminación</h4>
            <p>¿Estás seguro de que quieres eliminar este mensaje? Esta acción no se puede deshacer.</p>
            <div class="modal-actions">
                <button id="cancel-delete-btn" class="modal-btn secondary">Cancelar</button>
                <button id="confirm-delete-btn" class="modal-btn danger">Eliminar</button>
            </div>
        </div>
    </div>

    <script src="./js/floating_content.js" type="module"></script>
</body>

</html>